# Проект Shops

### Инструменты:

- Python
- Django Rest Framework
- PostgresQL
- Docker

## API:
### `GET /api/city` - получает список всех городов из базы данных

> Возращает HTTP код 200 в случае успешного получения данных и тело ответа. Пример:
`
[
    {
        "id": 1,
        "name": "Gorod"
    }
]
`

> 
> Возращает HTTP код 404 и сообщение 'NET GORODOV' в случае отсутствия городов в базе данных 

### `POST /api/city` - создает новый объект города

> Ожидает тело запроса. Пример:
`    {
        "name": "Gorod"
    }
`

> Возращает HTTP код 201 в случае успешного создания объекта и тело ответа. Пример:
`
    {
        "id": 1,
        "name": "Gorod"
    }
`

> Возращает HTTP код 400 в случае некорректного запроса и тело ответа с описанием ошибки. Пример:
`
{
    "name": [
        "This field is required."
    ]
}
`

> Возращает HTTP код 400 в случае попытки записать город, именование которого уже есть в базе данных, и тело ответа с описанием ошибки. Пример:
`
{
    "name": [
        "city with this name already exists."
    ]
}
`

### `GET /api/street?city_id=` - получает список всех улиц города по идентификатору города

city_id - обязательный параметр запроса

> Возращает HTTP код 200 в случае успешного получения данных и тело ответа. Пример:
`
[
    {
        "id": 1,
        "name": "Street",
        "city_id": "Gorod"
    }
]
`

> 
> Возращает HTTP код 400 и сообщение 'kakoi gorod to?' в случае отсутствия параметра запроса city_id

### `POST /api/street` - создает новый объект улицы

> Ожидает тело запроса. Пример:
`    
{
    "name":"Street",
    "city_id":"City"
}
`
>
> Так же создаст объект города по его названию, если в базе отстутсвует существующий город с таким же наименованием.


> Возращает HTTP код 201 в случае успешного создания объекта и тело ответа. Пример:
`
{
        "id": 1,
        "name": "Street",
        "city_id": "Gorod"
    }
`

> Возращает HTTP код 400 в случае некорректного запроса и тело ответа с описанием ошибки. Пример:
`
{
    "name": [
        "This field is required."
    ],
    "city_id": [
        "This field is required."
    ]
}
`

### `GET /api/shop?street=&city=&open=` - получает список всех улиц города по идентификатору города

street - не обязательный параметр запроса

city - не обязательный параметр запроса

open - не обязательный параметр запроса

| Query parameter |           Описание фильтра при указании           |
|-----------------|---------------------------------------------------|
| street          |В качестве значение передается идентификатор улицы. Возвращает все магазины на указанной улице.
| city            |В качестве значение передается идентификатор города. Возвращает все магазины в указанном городе.
| open            |В качестве значение передается 0 - флаг закрытия магазина и 1 - флаг открытия магазина. Возвращает либо список открытых магазинов относительно текущего времени, либо список закрытых магазинов. 

> Возращает HTTP код 200 в случае успешного получения данных и тело ответа. Пример:
`
[
    {
        "id": 1,
        "name": "Magazin",
        "street_id": "Street",
        "house": "10",
        "city_name": "Gorod",
        "open": 0
    }
]
`

### `POST /api/shop` - создает новый объект магазина

> Ожидает тело запроса. Пример:
`    
{
    "name": "Magazin",
    "street_id": "Street",
    "city":"Gorod",
    "house":"10",
    "open_time": 9,
    "close_time": 22
}
`
>
> Так же создаст объект города по его названию, если в базе отстутсвует существующий город с таким же наименованием и улицу, если в базе отсутствет улица с указанным наименованием и в указанном городе


> Возращает HTTP код 201 в случае успешного создания объекта и тело ответа. Пример:
`
{
    "id": 1,
    "name": "Magazin",
    "street_id": "Street",
    "house": "10",
    "city_name": "Gorod",
    "open": 1
}
`

> Возращает HTTP код 400 в случае некорректного запроса и тело ответа с описанием ошибки. Пример:
`
{
    "name": [
        "This field is required."
    ],
    "street_id": [
        "This field is required."
    ],
    "open_time": [
        "This field is required."
    ],
    "close_time": [
        "This field is required."
    ],
    "city": [
        "This field is required."
    ]
}
`

## Запуск проекта в терминале локальной машины:

Для локального запуска проекта необходима существующая база данных.

Настройка подключения к БД настраивается в файле `shops/podrygomy/podrygomy/settings.py` в переменной **DATABASES** 

Для запуска проекта необходимо выполнить несколько комманд:

1. pip install virtualenv
2. virtualenv venv
3. venv\Scripts\activate
4. pip install django djangorestframework psycopg2
5. pip install pytest-django
6. cd podrygomy
7. python manage.py migrate
8. python manage.py runserver

## Запуск проекта в Docker-контейнере:

Для запуска проекта в Docker-контейнере необходим установленный и запущенный **Docker** на локальной машине.

Необходимо запустить терминал в директории shops/docker и выполнить команду:
`docker-compose up --build`

## Запуск unit-тестов:

Для локального запуска Unit-тестов, необходимо в терминале выполнить следующую команду:

- python manage.py test --verbosity 2